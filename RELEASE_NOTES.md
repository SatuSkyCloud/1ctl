# Release Notes

## Version 0.4.0 (18-12-2025)

### ‚ú® New Features

- **Multi-Cluster Deployment**: Deploy applications across multiple Kubernetes clusters for high availability
  - New `--multicluster` flag to enable multi-cluster replication
  - New `--multicluster-mode` flag to choose deployment strategy:
    - `active-active`: Both clusters serve traffic simultaneously with geo-routing (ideal for stateless apps)
    - `active-passive`: Primary serves traffic, secondary is standby with automatic failover (ideal for stateful apps)
  - New `--backup-schedule` flag to configure backup frequency: `hourly`, `daily`, `weekly`
  - New `--backup-retention` flag to configure backup retention: `24h`, `72h`, `168h`, `720h`

### üîÑ API Enhancements

- **MulticlusterConfig Model**: Added new configuration model for multi-cluster deployments

  - `Enabled`: Toggle multi-cluster replication
  - `Mode`: Active-Active or Active-Passive deployment strategy
  - `BackupEnabled`: Enable Velero backups for data protection
  - `BackupSchedule`: Cron-based backup scheduling
  - `BackupRetention`: Duration-based backup retention
  - `FailoverEnabled`: Automatic failover on primary cluster failure
  - `RestoreOnFailover`: Automatic restore from backup on failover

- **Deployment Model Update**: Extended `Deployment` struct with `MulticlusterConfig` field

### üîß Technical Improvements

- **Orchestrator Enhancement**: Updated deployment orchestration to build and send multi-cluster configuration

  - Automatic cron schedule conversion from friendly names (hourly/daily/weekly)
  - Smart defaults: Active-passive mode automatically enables backup, failover, and restore-on-failover
  - Seamless integration with existing deployment workflow

- **DeploymentOptions Update**: Added multi-cluster fields to deployment options struct
  - `MulticlusterEnabled`: Enable/disable multi-cluster
  - `MulticlusterMode`: Deployment strategy selection
  - `BackupSchedule`: User-friendly schedule selection
  - `BackupRetention`: Retention duration

### üìö New Command Usage

```bash
# Deploy with multi-cluster enabled (active-passive with daily backups, 7-day retention)
1ctl deploy --cpu 100m --memory 256Mi --multicluster

# Deploy with active-active mode (geo-routing, no backups)
1ctl deploy --cpu 100m --memory 256Mi --multicluster --multicluster-mode active-active

# Deploy with custom backup configuration
1ctl deploy --cpu 100m --memory 256Mi --multicluster \
  --multicluster-mode active-passive \
  --backup-schedule hourly \
  --backup-retention 72h

# Full example with all options
1ctl deploy --cpu 500m --memory 1Gi \
  --machine my-machine-1 --machine my-machine-2 \
  --env DATABASE_URL=postgres://... \
  --multicluster \
  --multicluster-mode active-passive \
  --backup-schedule daily \
  --backup-retention 168h
```

### üìã Multi-Cluster Configuration Reference

| Flag                  | Default          | Description                            |
| --------------------- | ---------------- | -------------------------------------- |
| `--multicluster`      | `false`          | Enable multi-cluster deployment        |
| `--multicluster-mode` | `active-passive` | Deployment strategy                    |
| `--backup-schedule`   | `daily`          | Backup frequency (hourly/daily/weekly) |
| `--backup-retention`  | `168h`           | Backup retention period                |

### Backup Schedule Mapping

| Schedule | Cron Expression | Description              |
| -------- | --------------- | ------------------------ |
| `hourly` | `0 * * * *`     | Every hour               |
| `daily`  | `0 0 * * *`     | Daily at midnight UTC    |
| `weekly` | `0 18 * * 6`    | Weekly (Sunday 2 AM MYT) |

### Retention Options

| Value  | Duration | Use Case                        |
| ------ | -------- | ------------------------------- |
| `24h`  | 1 Day    | Quick recovery, minimal storage |
| `72h`  | 3 Days   | Short-term retention            |
| `168h` | 7 Days   | Recommended for most apps       |
| `720h` | 30 Days  | Long-term retention             |

### üîí Security

- Multi-cluster configuration securely transmitted via existing API authentication
- Backup and failover operations handled by operator with proper RBAC
- Cloudflare Load Balancer hostname auto-generated by backend

---

## Version 0.3.0 (30-09-2025)

### ‚ú® New Features

- **Multi-Organization Support**: Full support for users belonging to multiple organizations
  - New `org current` command to view current organization context
  - New `org switch` command to switch between organizations
  - Enhanced `auth status` command to display organization ID and namespace
  - Organization context automatically saved and restored across sessions

### üîÑ API Enhancements

- **Multi-Tenant Authentication**: Updated authentication flow to support multi-tenant backend

  - Login now returns and stores complete organization information (ID, name, namespace)
  - Token validation includes organization context
  - All API calls properly scoped to user's current organization
  - Fixed `/api-tokens/list` endpoint to include organization ID parameter

- **Backend Compatibility**: Updated all endpoints to work with multi-tenant backend
  - Fixed `TokenValidate` model types (UUID ‚Üí string) to match backend response
  - Added `GetUserProfile` API function for retrieving user organization details
  - Simplified login flow to use backend-provided organization data
  - Updated issuer endpoint to use upsert pattern (`/issuers/upsert`)

### üîß Technical Improvements

- **Enhanced Context Management**: Improved CLI context storage

  - Added `CurrentOrgID` and `CurrentOrgName` fields to context
  - New helper functions: `GetCurrentOrgID()`, `SetCurrentOrgID()`, `GetCurrentOrgName()`, `SetCurrentOrgName()`
  - New combined setter: `SetCurrentOrganization()` for atomic updates
  - Maintains backward compatibility with existing context files

- **Improved Organization Visibility**: Better user experience for multi-org environments

  - Auth status now shows: Email, Organization, Organization ID, Namespace, Token expiry
  - Deploy command properly uses current organization context by default
  - `--organization` flag allows deploying to specific organization/namespace

- **Comprehensive Test Coverage**: Added tests for all new features
  - 3 new test cases for organization context operations
  - 3 new test cases for org command structure
  - All tests passing with 100% coverage of new code
  - Updated existing tests to accommodate new fields

### üõ†Ô∏è Breaking Changes

- **TokenValidate Model Changes**: ID fields changed from `uuid.UUID` to `string` type
  - Affects: `UserID`, `TokenID`, `OrganizationID`
  - Added new fields: `Token`, `Namespace`, `Message`
  - Ensures compatibility with backend multi-tenant implementation

### üìö New Commands

```bash
# View current organization
1ctl org current

# Switch to different organization
1ctl org switch --org-id <organization-id>

# Enhanced auth status
1ctl auth status
```

### üîí Security

- All operations properly scoped to user's organization
- Context file maintains secure 0600 permissions
- Organization switching validates user access

## Version 0.2.2 (08-08-2025)

### ‚ú® New Features

- **Enhanced Docker Image Upload**: Added support for large Docker image uploads (>500MB and <8GB)

### üîÑ API Enhancements

- **Docker Upload Infrastructure**: Migrated Docker image uploads to dedicated service
  - Previous: `/docker/images/upload` endpoint on main API
  - New: Direct upload to specialized Docker upload service
  - Optimized for handling large binary transfers
  - Supports file sizes from 500MB to 8GB

## Version 0.2.1 (20-06-2025)

### üêõ Bug Fixes

- **Fixed ingress domain management**: Resolved issue where ingress upsert operations were generating new domains instead of reusing existing ones
  - Enhanced `upsertIngress` function to check for existing ingresses by deployment ID before creating new ones
  - Added proper existing domain name reuse logic to prevent unnecessary domain generation
  - Fixed Kubernetes error "ingress not found" by properly identifying and updating existing ingress resources
  - Improved ingress update flow to use existing domain names and preserve ingress IDs
  - Fixed ingress upsert response parsing to correctly handle backend's string response containing only the ingress ID

### üîß Technical Improvements

- **Enhanced Ingress API**: Added `GetIngressByDeploymentID` function to retrieve existing ingresses

  - Leverages existing backend route `/ingresses/deploymentId/:deploymentId`
  - Enables proper lookup of existing ingress resources during deployment updates
  - Simplifies client-side logic by leveraging backend's existing upsert capabilities

- **Improved Deployment Orchestration**: Enhanced ingress handling in deployment process
  - Better separation between new ingress creation and existing ingress updates
  - Consistent domain name handling across deployment scenarios
  - Improved logging and error messaging for ingress operations
  - Returns domain name from backend response to ensure consistency

### üîÑ API Enhancements

- **Ingress Management**: Streamlined ingress upsert operations to work seamlessly with backend logic
  - Client now properly leverages backend's existing ingress detection by namespace and app label
  - Reduced client-side complexity by relying on backend's robust upsert implementation
  - Enhanced error handling and response processing for ingress operations
  - Updated `UpsertIngress` to correctly unmarshal string ingress ID response from backend

## Version 0.2.0 (19-06-2025)

### ‚ú® Enhanced Command Structure

- **Simplified Deploy Command**: Removed `deploy create` subcommand and moved deployment flags directly to main `deploy` command

  - New usage: `1ctl deploy --cpu 100m --memory 20Mi --env HELLO=BYE --env SAY=WHAT`
  - Subcommands `list`, `get`, and `status` remain available
  - Enhanced validation with clear error messages for required flags

- **Simplified Service Command**: Removed `service create` subcommand and moved service flags directly to main `service` command

  - New usage: `1ctl service --deployment-id=123 --name=myservice --port=8080 --namespace=myorg`
  - Subcommands `list` and `delete` remain available
  - Required flags: `--deployment-id`, `--name`, `--port`

- **Simplified Ingress Command**: Removed `ingress create` subcommand and moved ingress flags directly to main `ingress` command
  - New usage: `1ctl ingress --deployment-id=123 --service-id=456 --app-label=myapp --namespace=myorg --domain=example.com`
  - Subcommands `list` and `delete` remain available
  - Required flags: `--deployment-id`, `--domain`, `--app-label`, `--namespace`

### üîÑ API Enhancements

- **Upsert Endpoints Migration**: Updated all resource creation to use upsert endpoints for idempotent operations

  - **Deployment**: `POST /deployments/upsert/:namespace/:appLabel` (namespace = organization, appLabel = app name)
  - **Service**: `POST /services/upsert/:namespace/:serviceName` (namespace = organization, serviceName = app name)
  - **Ingress**: `POST /ingresses/upsert/:namespace/:appLabel` (namespace = organization, appLabel = app name)

- **API Client Improvements**: Replaced create functions with upsert functions
  - `CreateDeployment` ‚Üí `UpsertDeployment`
  - `CreateService` ‚Üí `UpsertService`
  - `CreateIngress` ‚Üí `UpsertIngress`
  - Maintained same payload structure for backward compatibility

### üîß Technical Improvements

- **Enhanced User Experience**: Streamlined command syntax eliminates unnecessary subcommand nesting

  - Direct flag access from main commands improves CLI ergonomics
  - Consistent command patterns across deploy, service, and ingress resources
  - Maintained backward compatibility for list/delete subcommands

- **Comprehensive Test Updates**: Updated all test suites to reflect new command structure

  - Mock API functions updated to use upsert patterns
  - Integration tests migrated to new endpoint structure
  - Command tests updated with new handler functions
  - Maintained test coverage across all functionality

- **Shell Completion Updates**: Updated all shell completion scripts for new command structure

  - **Bash**: Removed obsolete "create" subcommands, updated flag completions
  - **Zsh**: Enhanced completion with new command patterns
  - **Fish**: Updated subcommand and flag completion logic
  - **PowerShell**: Removed deprecated creation commands from completions

- **Deployment Orchestrator**: Updated orchestration logic to use upsert operations

  - Service creation now uses `UpsertService` for idempotent operations
  - Ingress creation now uses `UpsertIngress` for consistent updates
  - Dependency handling updated with new upsert patterns
  - Improved error messages with operation context

- **Enhanced Image Upload Reliability**: Added retry mechanism for Docker image uploads

  - Automatic retry up to 3 attempts on upload failures
  - Exponential backoff strategy (2, 4, 8 seconds between retries)
  - Clear progress indication and error reporting for each attempt
  - Improved resilience against temporary network issues or server errors

- **Enhanced Docker Validation**: Significantly improved Dockerfile validation to support modern Docker features
  - **Multistage Build Support**: Now properly validates `FROM image AS stage_name` syntax
  - **Line Continuation Handling**: Fixed parsing of multi-line commands using backslash (`\`) continuations
  - **Enhanced Image Name Validation**: Updated regex patterns to support registry URLs, namespaces, and case-insensitive matching
  - **COPY --from Syntax**: Added proper validation for `COPY --from=stage_name` commands in multistage builds
  - **Stage Name Validation**: Validates stage names allow alphanumeric characters, underscores, and hyphens
  - **Comprehensive Test Coverage**: Added extensive test cases for all multistage build scenarios

### üõ†Ô∏è Breaking Changes

- **Command Structure**: Removed `create` subcommands from `deploy`, `service`, and `ingress` commands
  - Old: `1ctl deploy create --cpu 100m --memory 20Mi`
  - New: `1ctl deploy --cpu 100m --memory 20Mi`
  - Old: `1ctl service create --deployment-id=123 --name=myservice --port=8080`
  - New: `1ctl service --deployment-id=123 --name=myservice --port=8080`
  - Old: `1ctl ingress create --deployment-id=123 --domain=example.com`
  - New: `1ctl ingress --deployment-id=123 --domain=example.com --app-label=myapp --namespace=myorg`

## Version 0.1.8 (17-06-2025)

### ‚ú® New Features

- **Machine Marketplace Discovery**: Added `machine available` command to browse and filter available machines for rent
  - Comprehensive filtering options: `--region`, `--zone`, `--min-cpu`, `--min-memory`, `--gpu`, `--recommended`, `--pricing-tier`
  - Enhanced display with pricing information, performance metrics, and recommendation indicators
  - Real-time availability status and resource specifications

### üîß Technical Improvements

- **Updated Machine Model**: Synchronized frontend Machine model with enhanced backend structure

  - Changed `MachineID` from `uuid.UUID` to `string` type
  - Added new fields: `ID`, `Status`, `LastHealthCheck`, `Recommended`, `ResourceScore`
  - Added performance metrics: `CPUUsagePercent`, `MemoryUsagePercent`, `StorageUsagePercent`, `NetworkUsageGbps`
  - Added hardware features: `HasGPU`, `HasHDD`, `HasNVME`, `NodeType`
  - Added pricing information: `PricingTier`, `HourlyCost`
  - Added reliability metrics: `UptimePercent`, `ResponseTimeMs`, `NetworkMetricsType`

- **Enhanced Hostname Mapping**: Updated deployment logic to use machine IDs instead of machine names

  - Both manual machine selection (`--machine` flag) and automatic selection now use machine IDs
  - Improved deduplication logic based on unique machine IDs
  - Ensures consistent backend integration with machine ID-based deployments

- **Improved Machine Information Display**: Enhanced machine listing with additional useful information
  - Added Status, Node Type, Pricing Tier, and Hourly Cost to machine details
  - Added conditional display of Resource Score and Uptime percentage
  - Separate optimized display format for available machines marketplace

### üõ†Ô∏è API Enhancements

- Added `GetAvailableMachines()` API function for fetching monetized machines
- Updated `MachineIDs` struct to use string array instead of UUID array

## Version 0.1.7 (12-06-2025)

### üêõ Bug Fixes

- **Fixed hostname deduplication for monetized machines**: When multiple machines share the same hostname (e.g., "1"), the system now properly preserves the original hostname instead of incrementing it (e.g., "1" stays "1" instead of becoming "2")
  - Added hostname deduplication logic for owner's machines in automatic selection
  - Added hostname deduplication logic for manually specified machines via `--machine` flag
  - Ensures consistent hostname behavior across both user-owned and monetized machine deployments

### üîß Technical Improvements

- **Enhanced versioning system**: Fixed automatic version detection in build process
  - Updated `Taskfile.yml` to automatically detect version from Git tags instead of using hardcoded default
  - Added `task version` command to easily check current version information
  - Version now correctly reflects Git state with format like `v0.1.6-3-g94b0eb5` for commits ahead of tags
  - Improved build-time version injection with commit hash and build date

## Version 0.1.6 (22-03-2025)

### üîß Technical Improvements

- Version number fix only, no functional changes

## Version 0.1.5 (22-03-2025)

### üîß Technical Improvements

- Updated API endpoints for better resource management:
  - Fix secret and environment creation endpoints from `/create` to `upsert`
- Enforced minimum replica count for deployments (monetized).

## Version 0.1.4 (18-03-2025)

### üîß Technical Improvements

- Improved machine allocation system:
  - Automatic machine assignment if no specific hostnames provided
  - System now intelligently selects the most cost-effective machine based on resource requirements
- Enhanced hostname selection logic:
  - Prioritizes user-owned machines first
  - Falls back to monetized machines with automatic selection
  - Improved error handling for machine allocation

## Version 0.1.3 (17-01-2025)

### üîß Technical Improvements

- Introduced centralized error handling with `utils.NewError`
- Standardized error formatting across the codebase
- Improved error messages with better context and readability
- Added consistent error wrapping pattern
- Enhanced error handling in cleanup operations

## Version 0.1.2 (13-01-2025)

### üîß Technical Improvements

- Updated registry URL to use the new registry

## Version 0.1.1 (04-01-2025)

### üîí Security Improvements

- Added safe integer conversion handling to prevent overflows in port and replica configurations
- Enhanced path validation for file operations to prevent directory traversal attacks
- Improved Docker build input validation with tag format checking
- Implemented secure file permission handling (0750 for directories, 0600 for files)
- Added protection against command injection in Docker build operations
- Better error handling in cleanup operations for test utilities

### üîß Technical Improvements

- Introduced `SafeInt32` utility function for safe integer conversions
- Added path validation functions in Docker and context operations
- Enhanced error handling in file operations
- Improved input validation for Docker build options

## Version 0.1.0 (31-12-2024)

### üéâ Genesis Release

First public release of the Satusky CLI (1ctl) with core functionality for managing containerized applications on Satusky Cloud Platform.

### ‚ú® Features

#### Authentication

- Login with API token support
- Automatic token management and validation
- Session status checking
- Secure logout functionality

#### Machine Management

- List and view machine details

#### Deployment Management

- Create new deployments with customizable resources
- List and view deployment details
- Support for multiple deployment environments
- Real-time deployment status tracking with progress indicators
- Automatic Dockerfile detection and validation

#### Container Management

- Automated Docker image building
- Secure registry authentication
- Support for custom Dockerfiles
- Automatic image versioning and tagging

#### Resource Configuration

- CPU and memory allocation management
- Environment variables management
- Volume management for persistent storage
- Custom domain configuration
- Service port configuration

#### Service Management

- Create and configure services
- Automatic service discovery
- Port mapping and exposure

#### Networking

- Ingress configuration and management
- Custom domain support
- SSL/TLS certificate management
- Domain validation and verification

### üîß Technical Improvements

- Color-coded CLI output for better user experience
- Progress spinners for long-running operations
- Structured error handling and user feedback
- Comprehensive input validation
- Secure credential management

### üìö Documentation

- Basic usage documentation
- Command reference
- Installation instructions
- Resource limits documentation

### üîí Security

- Secure token storage
- Encrypted communication
- Input sanitization and validation

### üêõ Known Issues

- Broken CI (both unit and integration tests are not completed yet)
- Darwin 386 builds are not supported

### üìã Requirements

- Go 1.21 or higher
- Docker installed and running
- Verified Satusky Control Panel account

For detailed documentation, visit [https://docs.satusky.com/1ctl](https://docs.satusky.com/1ctl)
